<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- namespace指向mapper接口 -->
<mapper
	namespace="com.wt.restaurant.dao.dishorder.IDishOrderMapper">
<resultMap type="DishOrderLine" id="dishorderline">
		<id column="id" property="id" />
		<result column="dish_count" property="dishCount" />
		<result column="unit_price" property="unitPrice" />
		<result column="specifications" property="specifications" />
		
		<collection property="menu" ofType="Menu" column="id">
			<id column="menu_id" property="id" />
			<result column="name" property="name" />
		</collection>
	</resultMap>
	
	<select id="listDishOrder" resultType="DishOrder">
		SELECT
		id,
		order_number,
		reserve_type,
		create_time,
		total_count,
		total_amount,
		discount_amount,
		total_pay_amount,
		order_status,
		remark
		FROM
		dish_order
		where 1=1
		<if
			test="dishorder !=null and dishorder.reserveStartTime !=null and dishorder.reserveEndTime !=null">
			and
			create_time between #{dishorder.reserveStartTime} and
			#{dishorder.reserveEndTime}
		</if>
		<if test="dishorder !=null and dishorder.reserveType !=null">
			and
			reserve_type=#{dishorder.reserveType}
		</if>
		<if test="dishorder !=null and dishorder.orderStatus !=null">
			and
			order_status=#{dishorder.orderStatus}
		</if>
		ORDER BY create_time desc
		LIMIT
		${(currentPageNo-1)*pageSize},${pageSize}
	</select>

	<select id="listDishOrderByCustomerId" resultType="DishOrder">
		SELECT
		id,
		order_number,
		reserve_type,
		create_time,
		total_count,
		total_amount,
		discount_amount,
		total_pay_amount,
		order_status
		FROM
		dish_order
		WHERE
		customer_id=#{customerId}
	</select>

	<select id="listDishOrderMenu" resultMap="dishorderline">
		SELECT
		dish_order_line.id,menu.id AS menu_id,dish_count,unit_price,specifications,`name`
		FROM
		dish_order_line
		LEFT JOIN menu ON dish_order_line.menu_id=menu.id
		WHERE
		dish_order_line.dish_order_id=#{dishorderId}
	</select>

	<select id="countDishOrder" resultType="Integer">
		SELECT COUNT(*) FROM
		dish_order
	</select>

</mapper>